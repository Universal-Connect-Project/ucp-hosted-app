{
  "info": {
    "description": "Institution Service",
    "title": "UCP Institution Service",
    "version": "0.1.0"
  },
  "openapi": "3.0.0",
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  },
  "servers": [
    {
      "description": "Institution Service",
      "url": "http://localhost:8088"
    }
  ],
  "paths": {
    "/institutions": {
      "get": {
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "description": "Get the paginated list of Institutions",
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "default": 1
            },
            "required": false,
            "example": 30,
            "description": "Page to be returned in the paginated response."
          },
          {
            "in": "query",
            "name": "pageSize",
            "schema": {
              "type": "integer",
              "default": 10
            },
            "required": false,
            "example": 3,
            "description": "The number of institutions to be returned in the paginated response."
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "example": [
                    {
                      "currentPage": 30,
                      "pageSize": 3,
                      "totalRecords": 29489,
                      "totalPages": 9830,
                      "institutions": [
                        {
                          "id": "94b05c68-bab7-4694-9695-5934d8adf722",
                          "name": "Preferred Trust ",
                          "keywords": [],
                          "logo": "https://content.moneydesktop.com/storage/MD_Assets/Ipad%20Logos/100x100/default_100x100.png",
                          "url": "https://preferredtrustcompany.com/",
                          "is_test_bank": false,
                          "routing_numbers": [],
                          "createdAt": "2024-09-23T15:33:58.664Z",
                          "updatedAt": "2024-09-23T15:33:58.664Z",
                          "aggregatorIntegrations": [
                            {
                              "aggregator_institution_id": "5a74733d-aa8f-471a-b454-ca5bfda01902",
                              "supports_oauth": false,
                              "supports_identification": false,
                              "supports_verification": false,
                              "supports_aggregation": true,
                              "supports_history": false,
                              "isActive": true,
                              "aggregator": {
                                "name": "mx",
                                "id": 1,
                                "displayName": null,
                                "logo": null
                              }
                            },
                            {
                              "aggregator_institution_id": "2bbdf338-7fcc-4655-9c4d-5ccaffb60b2a",
                              "supports_oauth": false,
                              "supports_identification": false,
                              "supports_verification": false,
                              "supports_aggregation": true,
                              "supports_history": false,
                              "isActive": true,
                              "aggregator": {
                                "name": "sophtron",
                                "id": 2,
                                "displayName": null,
                                "logo": null
                              }
                            }
                          ]
                        },
                        {
                          "id": "5670bd8e-13c1-411f-bc88-34abf02ba6e4",
                          "name": "Greater State Bank (TX)",
                          "keywords": [],
                          "logo": "https://content.moneydesktop.com/storage/MD_Assets/Ipad%20Logos/100x100/default_100x100.png",
                          "url": "https://greaterstate.bank/",
                          "is_test_bank": false,
                          "routing_numbers": [],
                          "createdAt": "2024-09-23T15:33:58.664Z",
                          "updatedAt": "2024-09-23T15:33:58.664Z",
                          "aggregatorIntegrations": [
                            {
                              "aggregator_institution_id": "a9fb59b3-b9c2-4cd4-a3fc-9ca9c7eaa6cc",
                              "supports_oauth": false,
                              "supports_identification": false,
                              "supports_verification": false,
                              "supports_aggregation": true,
                              "supports_history": false,
                              "isActive": true,
                              "aggregator": {
                                "name": "mx",
                                "id": 1,
                                "displayName": null,
                                "logo": null
                              }
                            },
                            {
                              "aggregator_institution_id": "171045",
                              "supports_oauth": false,
                              "supports_identification": false,
                              "supports_verification": false,
                              "supports_aggregation": true,
                              "supports_history": false,
                              "isActive": false,
                              "aggregator": {
                                "name": "finicity",
                                "id": 3,
                                "displayName": null,
                                "logo": null
                              }
                            }
                          ]
                        },
                        {
                          "id": "e8d0a555-fc75-4e5a-9453-cad84bc0c8a4",
                          "name": "Andrews Federal Credit Union DMI ",
                          "keywords": [],
                          "logo": "https://content.moneydesktop.com/storage/MD_Assets/Ipad%20Logos/100x100/default_100x100.png",
                          "url": "https://andrewsfcu.mtgsvc.com/Account/UserLogin?conn=Q67%7B52609b13-69a0-4acd-8e5a-c3bc366bb7bd%7D",
                          "is_test_bank": false,
                          "routing_numbers": [],
                          "createdAt": "2024-09-23T15:33:58.664Z",
                          "updatedAt": "2024-09-23T15:33:58.664Z",
                          "aggregatorIntegrations": [
                            {
                              "aggregator_institution_id": "e85f0f46-1bcd-4b5f-b1a2-cb14699e9cbd",
                              "supports_oauth": false,
                              "supports_identification": false,
                              "supports_verification": false,
                              "supports_aggregation": true,
                              "supports_history": false,
                              "isActive": true,
                              "aggregator": {
                                "name": "mx",
                                "id": 1,
                                "displayName": null,
                                "logo": null
                              }
                            },
                            {
                              "aggregator_institution_id": "32ead61c-ad84-4a4b-8bae-66f3c0bf6ba6",
                              "supports_oauth": false,
                              "supports_identification": false,
                              "supports_verification": false,
                              "supports_aggregation": true,
                              "supports_history": false,
                              "isActive": true,
                              "aggregator": {
                                "name": "sophtron",
                                "id": 2,
                                "displayName": null,
                                "logo": null
                              }
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          }
        },
        "summary": "Institution List"
      }
    },
    "/institutions/cacheList": {
      "get": {
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "description": "Get the entire institution list formatted to save in the UCW-app",
        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "example": [
                    {
                      "id": "b2c01271-10e3-4f24-9236-44719e41fb40",
                      "name": "FinBank Profiles - A",
                      "keywords": ["finbank", "finicity"],
                      "logo": "https://prod-carpintero-branding.s3.us-west-2.amazonaws.com/102105/icon.svg",
                      "url": "http://www.finbank.com",
                      "is_test_bank": true,
                      "routing_numbers": [],
                      "finicity": {
                        "id": "102105",
                        "supports_oauth": false,
                        "supports_identification": true,
                        "supports_verification": true,
                        "supports_aggregation": true,
                        "supports_history": false
                      }
                    },
                    {
                      "id": "a44e81b6-127f-46fb-be3f-8898354c95f1",
                      "name": "MX Bank (Oauth)",
                      "keywords": ["Gringotts", "MX Bank", "oauth"],
                      "logo": "https://s3.amazonaws.com/MD_Assets/Ipad%20Logos/100x100/INS-3aeb38da-26e4-3818-e0fa-673315ab7754_100x100.png",
                      "url": "https://mx.com",
                      "is_test_bank": true,
                      "routing_numbers": [],
                      "mx": {
                        "id": "mx_bank_oauth",
                        "supports_oauth": true,
                        "supports_identification": true,
                        "supports_verification": true,
                        "supports_aggregation": false,
                        "supports_history": false
                      }
                    },
                    {
                      "id": "ee0afbc5-47ab-4e6e-aa32-fea3a91fa606",
                      "name": "Alabama Credit Union",
                      "keywords": ["ACU", "Alabama CU", "Alabama Credit Union"],
                      "logo": "https://content.moneydesktop.com/storage/MD_Assets/Ipad%20Logos/100x100/INS-c4d51160-465e-1d78-4a50-fd6836684c3a_100x100.png",
                      "url": "https://www.alabamacu.com/",
                      "is_test_bank": false,
                      "routing_numbers": ["262277419"],
                      "mx": {
                        "id": "alabamacreditunion",
                        "supports_oauth": false,
                        "supports_identification": true,
                        "supports_verification": true,
                        "supports_aggregation": true,
                        "supports_history": true
                      },
                      "sophtron": {
                        "id": "4D1C263B-D291-4DF7-9F22-79E445E59526",
                        "supports_oauth": false,
                        "supports_identification": true,
                        "supports_verification": true,
                        "supports_aggregation": false,
                        "supports_history": false
                      },
                      "finicity": {
                        "id": "5411",
                        "supports_oauth": false,
                        "supports_identification": true,
                        "supports_verification": false,
                        "supports_aggregation": true,
                        "supports_history": false
                      }
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          }
        },
        "summary": "Institution Cache List"
      }
    },
    "/institutions/:id": {
      "put": {
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "description": "Update an Institution",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "schema": {
              "type": "integer"
            },
            "required": true,
            "description": "UCP ID of the Institution to update"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "keywords": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "logo": {
                    "type": "string"
                  },
                  "url": {
                    "type": "string"
                  },
                  "is_test_bank": {
                    "type": "boolean"
                  },
                  "routing_numbers": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "example": {
                    "message": "Institution updated successfully",
                    "institution": {
                      "id": "UCP-024b97a3cd4d4df",
                      "name": "FinBank Profiles - A",
                      "keywords": ["finbank", "finicity"],
                      "logo": "https://prod-carpintero-branding.s3.us-west-2.amazonaws.com/102105/icon.svg",
                      "url": "http://www.finbank.com",
                      "is_test_bank": true,
                      "routing_numbers": ["123456789"],
                      "createdAt": "2024-09-10T16:07:46.038Z",
                      "updatedAt": "2024-09-11T17:22:35.653Z"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "example": {
                    "error": "\"logo\" must be a valid uri with a scheme matching the http|https pattern"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "example": {
                    "error": "Aggregator cannot edit an institution used by other aggregators"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/permissions": {
      "get": {
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "description": "Get institution permissions",
        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "example": {
                    "canCreateInstitution": true
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/institutions": {
      "post": {
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "description": "Create an Institution",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "keywords": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "logo": {
                    "type": "string"
                  },
                  "url": {
                    "type": "string"
                  },
                  "is_test_bank": {
                    "type": "boolean"
                  },
                  "routing_numbers": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "example": {
                    "institution": {
                      "id": "UCP-024b97a3cd4d4df",
                      "name": "FinBank Profiles - A",
                      "keywords": ["finbank", "finicity"],
                      "logo": "https://prod-carpintero-branding.s3.us-west-2.amazonaws.com/102105/icon.svg",
                      "url": "http://www.finbank.com",
                      "is_test_bank": true,
                      "routing_numbers": ["123456789"],
                      "createdAt": "2024-09-10T16:07:46.038Z",
                      "updatedAt": "2024-09-11T17:22:35.653Z"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "example": {
                    "error": "\"logo\" must be a valid uri with a scheme matching the http|https pattern"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    }
  }
}
